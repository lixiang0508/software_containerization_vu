# software_containerization_vu
1.Deploy Database (MySQL)

1.1 kubectl apply -f 
cm.yaml  
(Create configmap to deploy database configuration files)
secret.yaml 
(Save the username ‘root’  and password ‘jinling123’ (Base-64 encode))
pvc.yaml  
(Apply for the persistent volume)
mysql.yaml 
(Create deployment/service)

1.2 
kubectl get pods  
(Check the status of the pods and get the ID)

Kubectl exec –it mysql-fox-deployment-75bc8fc76d-z9tps /bin/bash  
(Use “mysql –uroot –p”   to check the connection)

create database veganmall;
use veganmall;
paste the queries from veganmall_2023-01-15.sql and execute;

2. Springboot API Deployment:
2.1
cd backend
kubectl create cm vegan-cm --from-file=application.properties -nvegan
(Create a configmap file to mount the springboot configuration file）



openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt

kubectl create secret tls https-secret --key tls.key --cert tls.crt –nvegan   (create secret)

for an example in windows：C:\Windows\System32\drivers\etc 

in this file  (C:\Windows\System32\drivers\etc) ,add  a pair of server ip and hostname (“vegan.com”)


Kubectl apply –f . （Execute the backend.yaml pvc.yaml rbac.yaml service.yaml ）

test: http://ip:port


3. React API Deployment:

cd frontend
Kubectl apply –f .    (execute all the yaml files in the folder)

please move the dist folder to /var/snap/microk8s/common/default-storage/
Notice: the dist folder is generated by npm start in the veganfrontend, please change PATH in  veganfront/src/redux/constant.js according to your own ip addressvegaveganfront/src/redux/constant.js
nfront/src/redux/constant.js
veganfront/src/redux/constant.js






4. Network policy Deployment:
cd ../
kubectl apply -f NP.yaml (only those labeled with veganpro is allowed to visit)

5 Helm rollout canary:
cd helm
helm install vegen -n vegan .
helm install vegenpro -n vegan .

cd helm/vegenpro 
vim values.yaml 

Set canary.enable =true  to open canary 
 
helm upgrade veganpro -n vegan. 
Change /var/snap/microk8s/common/default-storage/dist/index.html (add some text to index.html) 

(Canary update→ if we refresh the website the change will disappear, then refresh again, it will appear again)


cd ../vegen
vim values.yaml
Change image.tag to v 1.3
helm upgrade vegan -n vegan .

vim values.yaml（In order to demonstrate the effect, we will modify the image name. Change image.tag back  to v 1.1） 
helm upgrade vegan -nvegan .

kubectl rollout history deploy vegan -nvegan
kubectl rollout undo deploy vegan -nvegan –to-revision=2


helm uninstall vegen -n vegan .
helm uninstall vegenpro -n vegan .



